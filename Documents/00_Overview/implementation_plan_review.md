# Phase 7 受入出庫記録 実装計画レビュー（最新確認）

## 残る懸念点
- **BranchNumber変更時にBarcodeKeyを再計算していない**: 「BranchNumber変更時の対応」フローはCompositeKeyのみ再計算。BarcodeKey（MakerCode/BranchNumber/Lot/Date）も同期更新しないと拠点変更後のバーコードが旧値のままになる。
- **BranchNumber=00ブロックの切替手順が未定**: Phase 6で空欄を一括で"00"にしてから、Phase 7でPower Apps側保存不可にしているが、切替タイミングを誤ると受入登録が全面停止する。ブロック開始日時・暫定猶予・例外運用を決める必要がある。
- **BarcodeKeyフォールバック例が静的IDを残して混在**: 期待結果は動的計算に直したが「正常系との比較」欄で `INV000005-…` の固定例が残存し、テスト手順の読み手が誤った固定期待値で判定する恐れがある。
- **CompositeKey再計算スクリプトの一意制約前提が明示されていない**: 再計算中に一意制約が有効だと途中で例外が出る。実行前に一意制約を無効にしておく（または未設定である）ことを手順に明記しておくと安全。
- **BranchNumber空→"00"正規化の再実行要件**: 再計算スクリプトで空値を"00"に補完するが、その後BranchNumberを正値に直したときに再計算/重複チェックを必須とする旨が明文化されていない。変更後に再計算を自動または手動で実施するルールを追加したい。

これらを追記すれば、ブロック切替時の業務停止リスクとキー不整合のリスクをさらに低減できます。
