# Phase5 送付フロー 指摘まとめ

## 日付
2026年1月30日

## 対象ファイル
`Documents/Phase5_送付フロー計画書.md`（最終更新: 2026年1月20日 17:44）

## 指摘事項
1. SendStatus列の定義が未記載。フローのトリガー/遷移に依存しており、列の型・内部名・許容値が不明。
2. 手動更新を起点にするが重複送付や再実行時の制御（既送付判定/エラー状態/リトライ方針）が未定義。
3. 業者マスタCSVの配置場所・スキーマ・キー項目（業者名/ID）とリスト側の突合せ方法が未定義。
4. 送付前の必須入力チェックが不十分。納品先・業者情報・見積書番号の空欄許容範囲がフロー条件に反映されていない。
5. 差し込みフィールド名が実際のSharePoint内部名と対応付いていないため、変換時の取り違えリスクがある。
6. 生成したPDF/Excelの保存先・命名規則・保管/参照権限が未記載。

## 推奨対応
- SendStatus列（Choice）の内部名・値（例: 送付前/送付中/送付済/エラー）を明記し、トリガー条件に反映する。
- 送付済み判定と再実行ルール（失敗時のリトライ/二重送付防止）をフロー仕様として定義する。
- 業者マスタCSVの列定義（業者ID、業者名、メールアドレス等）と突合せキーを明記する。
- 送付前の必須チェック（納品先、業者メール等）をフロー条件に追加する。
- 差し込みフィールドとSP内部名の対応表を作成する。
- 生成ファイルの保存先/命名規則/保管期間/権限を決めて記載する。

## 日付
2026年1月30日

## 対象ファイル
`Documents/Phase5_送付フロー計画書.md`（最終更新: 2026年1月30日 14:40）

## 指摘事項
1. 必須入力チェック/業者突合せNG時のSendStatus遷移が未記載で、SendStatus=送付中のまま残る可能性がある。
2. 業者マスタはVendorIDを定義しているが、突合せは業者名の完全一致のみ。表記揺れ・同名混在リスクが残る。加えて、SharePoint側の「業者名」列の定義がStep 1にない。
3. 送信失敗時の通知・エラー詳細ログの定義がなく、リトライ待ちの起点や担当者が不明。
4. 生成ファイル命名にTitle/業者名を使用するため、禁止文字や長さ超過で保存失敗の可能性がある。
5. 保管期間「5年」の根拠が不明。法定保存期間の区分確認が必要。

## 推奨対応
- NG時のSendStatus遷移（送付前へ戻す/エラーへ遷移）と再実行手順を明記する。
- 業者マスタとの突合せキーをVendorIDへ変更し、SP側に業者ID/業者名列の定義を追加する（またはLookup列化）。
- エラー通知（担当者/管理者）とエラー理由の記録先（ログ列/履歴リスト）を定義する。
- ファイル名のサニタイズ/ID採用/長さ制限のルールを追記する。
- 保管期間の根拠資料を確認し必要なら修正する。

## 日付
2026年1月30日

## 対象ファイル
`Documents/Phase5_送付フロー計画書.md`（最終更新: 2026年1月30日 14:45）

## 指摘事項
1. ErrorLogの記録形式・追記方式が未定義。上書きされるとエラー履歴が失われる。
2. エラー通知の通知先が不明確で、業者マスタ不整合時の通知先が図と表で不一致（フロー図は担当者のみ、通知表は管理者含む）。
3. 業者マスタCSVは`yymmdd`付きファイル名のため、複数存在時の参照ルール（最新/固定/手動指定）が未定義。
4. 命名規則の`[ID]`が何のIDか未定義（SharePointリストIDか独自IDか）。

## 推奨対応
- ErrorLogの書式（日時・エラーコード・内容）と追記方式を定義し、履歴が残るようにする。
- 通知先（担当者/管理者）の具体的アカウント/グループを明記し、業者マスタ不整合時の通知先を図と表で統一する。
- CSV参照ルール（最新日付ファイル固定/固定ファイル名/リスト化）を明記する。
- `[ID]`の出所を明記し、必要なら別名のカラムを追加する。

## 日付
2026年1月30日

## 対象ファイル
`Documents/Phase5_送付フロー計画書.md`（最終更新: 2026年1月30日 14:50）

## 指摘事項
1. 確定事項の「業者マスタ」が`業者連絡先yymmdd.csv`のままで、本文の固定名`業者連絡先.csv`と不一致。
2. 「実装前の準備作業」チェックリストに、追加が必要な列（業者ID・業者名・ErrorLog）が抜けている。
3. SendStatusの「エラー」意味が「送信失敗」と記載されているが、必須入力NG/業者マスタ不整合も含めて使用するため定義が不整合。

## 推奨対応
- 確定事項の業者マスタ名を固定名に合わせて修正する。
- 準備作業チェックリストに業者ID・業者名・ErrorLog列の追加を追記する。
- SendStatus=エラーの意味を「処理失敗（入力NG/突合せNG/送信失敗）」などに修正する。

## 日付
2026年1月30日

## 対象ファイル
`Documents/Phase5_送付フロー計画書.md`（最終更新: 2026年1月30日 14:55）

## 指摘事項
1. 業者マスタ不整合時の通知先がセクション間で不一致（フロー図/エラー通知表は担当者+管理者、送付前必須チェックとStep 4は担当者のみ）。

## 推奨対応
- 業者マスタ不整合時の通知先を統一し、フロー図・送付前必須チェック・Step 4・エラー通知表の記載を一致させる。
