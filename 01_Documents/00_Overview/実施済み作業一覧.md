# SharePoint承認フロー プロジェクト 実施済み作業一覧

**最終更新**: 2026年2月10日
**現在のバージョン**: 1.1.0.3

---

## ✅ 完了済み機能・改善

### 1. 数量・見積額が0になる問題の解決（2026/01/19）

| 項目 | 内容 |
|------|------|
| **問題** | フォームで入力した数量・見積額が0に上書きされる |
| **原因** | 「発注リスト更新」フローがトリガー時の空データで上書き |
| **解決策** | 「項目の更新1」から注文数フィールドを削除、承認フローにfield_5/field_6を追加 |
| **ステータス** | ✅ 動作確認済 |

---

### 2. Power Appsカスタムフォーム復帰（2026/01/19）

- 標準フォームでテスト後、カスタムフォームに戻し正常動作を確認

---

### 3. バージョン管理ルール策定（2026/01/20）

| 変更種別 | ルール | 例 |
|----------|--------|-----|
| 機能追加 | マイナー（2桁目）更新 | 1.0.0.x → 1.1.0.0 |
| バグ修正 | リビジョン（4桁目）更新 | 1.1.0.0 → 1.1.0.1 |

---

### 4. プロジェクトフォルダ整理（2026/01/20）

| フォルダ | 用途 |
|----------|------|
| `03_Release/` | 最新の安定版パッケージ |
| `Archive/` | 過去バージョン履歴 |
| `01_Documents/` | 引継ぎ・設計資料 |
| `99_Archive/Old_Work/` | 開発用一時フォルダ |

---

### 5. フィールド名改善 A案（2026/01/20）

フローJSONにマッピングコメントを追加して可読性向上：

| 内部名 | 意味 |
|--------|------|
| field_5 | 注文数（Quantity） |
| field_6 | 見積額（EstimatedAmount） |
| field_8 | 承認ステータス |
| field_9 | 追加承認者 |
| field_11 | 備考 |

---

### 6. Phase 5 送付フロー計画策定（2026/01/20）

承認後の業者送付フローの計画を確定：

| 項目 | 決定内容 |
|------|---------|
| 発注書 | Word→PDF自動生成 |
| 請書 | Excel（業者編集可能） |
| 送付担当者 | sengas@cellgentech.com（固定） |
| トリガー | SharePointリストでSendStatus変更 |
| 業者マスタ | `業者連絡先yymmdd.csv` |

詳細: `01_Documents/01_Phases/Phase5_送付フロー/Phase5_送付フロー計画書.md`

---

### 7. Documents 整理（2026/01/30）

| 項目 | 内容 |
|------|------|
| フォルダ再編 | `00_Overview` / `01_Phases` / `02_Templates` / `03_DataSamples` / `04_Reference` を作成 |
| 移動・整理 | Phase計画書/指摘まとめ/手順書を `01_Phases` に集約、テンプレ/サンプル/参照を分類 |
| README整備 | `01_Documents/README.md` を作成し、目次と相対リンクを整理 |

---

### 8. 見積依頼スキル 運用開始前チェック（2026/02/09-10）

| 項目 | 内容 |
|------|------|
| 依存導入 | `05_mail/requirements.txt` のライブラリ導入を実施 |
| ドライラン設定 | `05_mail/config.json` の `dry_run` を `true` に設定 |
| 動作確認 | サンプル連絡先2件でドライラン成功（成功2件/失敗0件） |
| ログ出力 | `05_mail/logs/` に監査ログ・送信済みリストを出力 |
| **テスト送信** | **自分宛テスト送信成功（sengas@cellgentech.com）** |
| **テストスクリプト** | **`05_mail/test_send.py` 作成** |

---

### 9. Phase 5 テンプレート作成完了（2026/02/06）

| 項目 | 内容 |
|------|------|
| **発注書テンプレート** | Word Content Control 9フィールド、ヘッダー（社名・ロゴ）挿入、冪等化対応 |
| **請書テンプレート** | Excel シート保護、計算式（IF/SUM）、業者入力セル設定 |
| **検証ツール** | create_test_samples.py, verify_flow_error_handling.py, verify_template_integrity.py |
| **テスト出力** | TestOutput/ に Word/Excel/PDF サンプル生成完了 |
| **Power Automateフロー** | Send_OrderDocs_SP スケルトン定義エクスポート済み |

---

### 10. Phase 5 列追加・業者マスタ準備（2026/02/10）

| 項目 | 内容 |
|------|------|
| **列追加スクリプト** | `02_Scripts/AddPhase5Columns.ps1` 作成（7列: OrderID, DeliveryAddress, VendorID, QuoteNumber, SortOrder, SendStatus, ErrorLog） |
| **業者マスタCSV** | `01_Documents/02_Templates/vendor_master_template.csv` 作成（UTF-8 BOM、7列簡素化フォーマット） |

---

## ⏸️ 保留中

### メール添付ファイル機能

- **目的**: 承認メールに見積書PDFを添付
- **現状**: JSONインポートではパラメータエラー発生
- **代替手段**: メール本文のSharePointリンクから確認可能
- **推奨対応**: Power Automate GUIで手動追加

---

## 📋 次回作業

### 見積依頼スキル

- [x] `05_mail/config.json` の `test_email` を設定 ✅
- [x] 自分宛にテスト送信 ✅
- [ ] `test_mode` を `false` にして本番運用開始

### Phase 5 準備

- [x] 発注書Wordテンプレート作成（Content Control 9フィールド、冪等化済み）✅
- [x] 請書Excelテンプレート作成（シート保護・計算式検証済み）✅
- [x] テンプレート二重化問題修正（Backup復元・modify_word_template.py冪等化）✅
- [x] 複数明細対応ロジック実装・検証（create_test_samples.py）✅
- [x] エラーハンドリング検証（verify_flow_error_handling.py）✅
- [x] 列追加スクリプト作成（`02_Scripts/AddPhase5Columns.ps1`）✅
- [x] 業者マスタCSVテンプレート作成（`01_Documents/02_Templates/vendor_master_template.csv`）✅
- [ ] SharePoint列追加スクリプト実行（OrderID, DeliveryAddress, VendorID, QuoteNumber, SortOrder, SendStatus, ErrorLog）
- [ ] 業者マスタCSVをSharePointにインポート
- [ ] PDF変換テスト（Word COM要 / GUI操作）
- [ ] Excel 2016互換性テスト（GUI操作）

> 📌 「次のタスクを確認して実行」と依頼されたら、上記のタスク管理表を参照してください。

---

## 環境情報

| 項目 | 値 |
|------|------|
| SharePointサイト | https://cellgentech.sharepoint.com/sites/SP__Prototype |
| リストID | 62b6ee4c-05b5-42e3-b9be-fe9fcc1ccdcd |
| リスト名 | 発注依頼_Requests_Test |
| 承認フロー | Requests_Approval_SP |
| 採番フロー | 発注リスト更新 |
| 最新パッケージ | automation_1_1_0_2.zip |
